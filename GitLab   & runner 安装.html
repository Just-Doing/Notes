<html>
<head>
  <title>GitLab   &amp; runner 安装</title>
  <basefont face="微软雅黑" size="2" />
  <meta http-equiv="Content-Type" content="text/html;charset=utf-8" />
  <meta name="exporter-version" content="YXBJ Windows/600667 (zh-CN, DDL); Windows/10.0.0 (Win64);"/>
  <style>
    body, td {
      font-family: 微软雅黑;
      font-size: 10pt;
    }
  </style>
</head>
<body>
<a name="527"/>
<h1>GitLab   &amp; runner 安装</h1>

<div>
<span><div><div><div><font style="font-size: 14pt;"><span style="font-size: 14pt; font-weight: bold;">Gitlab 是代码管理仓库</span></font></div><ol><li><div>设置Gitlab 源 地址</div></li></ol><div><br/></div><div style="margin: 0px; padding: 0px; font-size: 14px; letter-spacing: normal; orphans: 2; text-align: left; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><span style="font-size: 14px; background-color: rgb(247, 247, 247); box-sizing: border-box; outline: 0px; position: relative; white-space: pre-wrap; overflow-wrap: break-word; overflow-x: auto; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; border: none; color: rgb(51, 51, 51); font-family: monospace; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 22px;">curl -sS</span> <a href="https://packages.gitlab.com/install/repositories/gitlab/gitlab-ce/script.rpm.sh" style="font-size: 14px; background-color: rgb(247, 247, 247); font-family: monospace; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 22px;">https://packages.gitlab.com/install/repositories/gitlab/gitlab-ce/script.rpm.sh</a> <span style="font-size: 14px; background-color: rgb(247, 247, 247); box-sizing: border-box; outline: 0px; position: relative; white-space: pre-wrap; overflow-wrap: break-word; overflow-x: auto; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; border: none; color: rgb(51, 51, 51); font-family: monospace; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 22px;">| sudo bash</span></div><div style="margin: 0px; padding: 0px; font-size: 14px; letter-spacing: normal; orphans: 2; text-align: left; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><span style="box-sizing: border-box; outline: 0px; position: relative; white-space: pre-wrap; overflow-wrap: break-word; overflow-x: auto; font-size: 14px; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(247, 247, 247); border: none; color: rgb(51, 51, 51); font-family: monospace; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 22px;">yum install -y gitlab-ce</span></div><ol start="2"><li><div>安装Gitlab</div></li></ol><div><br/></div><div><span style="color: rgb(255, 0, 0);">yum makecache</span></div><div><span style="color: rgb(255, 0, 0);">yum install gitlab-ce</span></div><div><br/></div><div><br/></div><ol start="3"><li><div>启动gitlab</div></li></ol><div><span style="color: rgb(255, 0, 0);">gitlab-ctl reconfigure   启动服务   </span><span style="color: rgb(255, 0, 0);">（比较慢）</span></div><div><br/></div></div><ol start="4"><li><div>安装成功  访问站点</div></li></ol><div><span style="color: rgb(255, 0, 0);">地址：http://[安装的机器IP]</span></div><div><span style="color: rgb(255, 0, 0);">首次登录需要设置密码</span></div><div><span style="color: rgb(255, 0, 0);">设置成功之后登录---用户名：</span> <span style="font-size: 14px; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; color: rgb(255, 0, 0); font-family: &quot;Helvetica Neue&quot;, Helvetica, Verdana, Arial, sans-serif; font-variant-caps: normal; font-variant-ligatures: normal;">root</span></div><div><span style="font-size: 14px; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><br/></span></div><ol start="5"><li><div><span style="font-size: 11pt; font-family: &quot;Helvetica Neue&quot;;">安装gitlab会自动安装git</span></div></li><li><div><span style="font-size: 11pt; font-family: &quot;Helvetica Neue&quot;;">在gitlab配置文件中修改仓库的项目地址（/etc/gitlab/gitlab.rb 文件开始部分）  </span><span style="font-size: 11pt; font-family: &quot;Helvetica Neue&quot;;">external_url &quot;</span><a href="http://gitlab.example.com/" style="font-size: 11pt; font-family: &quot;Helvetica Neue&quot;;">http://1</a><span style="font-size: 11pt; font-family: &quot;Helvetica Neue&quot;;">92.168.3.101&quot; </span></div></li></ol><div><span style="font-size: 11pt;"><br/></span></div><div><span style="font-size: 11pt; font-family: &quot;Helvetica Neue&quot;;">启用SSL</span></div><div><span style="font-size: 11pt; font-family: &quot;Helvetica Neue&quot;;"> 配置步骤：</span></div><div><span style="font-size: 11pt; font-family: &quot;Helvetica Neue&quot;;">    1：安装证书</span></div><div><span style="font-size: 11pt; font-family: &quot;Helvetica Neue&quot;;">        yum install openssl</span></div><div><span style="font-size: 11pt; font-family: &quot;Helvetica Neue&quot;;">        </span><span style="font-size: 11pt; font-family: &quot;Helvetica Neue&quot;;">openssl genrsa -des3 -out</span> <span style="font-size: 11pt; font-family: &quot;Helvetica Neue&quot;;">server.key </span><span style="font-size: 11pt; font-family: &quot;Helvetica Neue&quot;;">2048</span></div><div><span style="letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: pre; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(246, 248, 250); color: rgb(79, 79, 79); font-variant-caps: normal; font-variant-ligatures: common-ligatures;"><span style="font-size: 14px; background-color: rgb(246, 248, 250); color: rgb(79, 79, 79); font-variant-caps: normal; font-variant-ligatures: common-ligatures; font-family: &quot;Source Code Pro&quot;, &quot;DejaVu Sans Mono&quot;, &quot;Ubuntu Mono&quot;, &quot;Anonymous Pro&quot;, &quot;Droid Sans Mono&quot;, Menlo, Monaco, Consolas, Inconsolata, Courier, monospace, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, sans-serif;">    </span></span> <span style="font-size: 11pt; color: rgb(79, 79, 79); font-family: &quot;Source Code Pro&quot;;">openssl req -new -key </span><span style="font-size: 11pt; font-family: &quot;Helvetica Neue&quot;;">server.key</span><span style="font-size: 11pt; color: rgb(79, 79, 79); font-family: &quot;Source Code Pro&quot;;"> -out </span><span style="font-size: 11pt; color: rgb(79, 79, 79); font-family: &quot;Source Code Pro&quot;;">server</span><span style="font-size: 11pt; color: rgb(79, 79, 79); font-family: &quot;Source Code Pro&quot;;">.csr</span></div><div><span style="font-size: 11pt; font-family: &quot;Helvetica Neue&quot;;">        openssl req -new -x509 -days 3650 -key </span><span style="font-size: 11pt; font-family: &quot;Helvetica Neue&quot;;">server.key</span><span style="font-size: 11pt; font-family: &quot;Helvetica Neue&quot;;"> -out </span><span style="font-size: 11pt; font-family: &quot;Helvetica Neue&quot;;">server.crt</span></div><div><span style="font-size: 11pt; font-family: &quot;Helvetica Neue&quot;;">        chmod 600 *  修改本地证书权限</span></div><div><span style="font-size: 11pt;"><br/></span></div><div><span style="box-sizing: border-box; font-size: 16px; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(247, 247, 247); color: rgb(47, 47, 47); font-family: -apple-system, &quot;SF UI Text&quot;, Arial, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;WenQuanYi Micro Hei&quot;, sans-serif; font-variant-caps: normal; font-variant-ligatures: normal; font-weight: bold;">注</span><span style="font-size: 16px; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(247, 247, 247); color: rgb(47, 47, 47); font-family: -apple-system, &quot;SF UI Text&quot;, Arial, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;WenQuanYi Micro Hei&quot;, sans-serif; font-variant-caps: normal; font-variant-ligatures: normal;">: 第一步和第二部可以合并成一条命令</span></div><div><span style="box-sizing: border-box; font-size: 13px; background-color: rgb(246, 246, 246); border-radius: 4px; border: none; white-space: pre-wrap; vertical-align: middle; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; color: rgb(199, 37, 78); font-family: Menlo, Monaco, Consolas, &quot;Courier New&quot;, monospace; font-variant-caps: normal; font-variant-ligatures: normal;">openssl req -nodes -newkey rsa:2048 -keyout</span> <span style="color: rgb(199, 37, 78); font-family: Menlo;">server.key </span><span style="box-sizing: border-box; font-size: 13px; background-color: rgb(246, 246, 246); border-radius: 4px; border: none; white-space: pre-wrap; vertical-align: middle; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; color: rgb(199, 37, 78); font-family: Menlo, Monaco, Consolas, &quot;Courier New&quot;, monospace; font-variant-caps: normal; font-variant-ligatures: normal;">-out</span> <span style="color: rgb(199, 37, 78); font-family: Menlo;">server.csr</span></div><div><span style="font-size: 11pt; font-family: &quot;Helvetica Neue&quot;;">  2.配置gitlab 也就是修改gitlab.rb 文件</span></div><div><span style="font-size: 11pt; font-family: &quot;Helvetica Neue&quot;;">        </span><span style="font-family: &quot;Helvetica Neue&quot;; font-size: 11pt;">找到external_url '</span><a href="http://gitlab.example.com/" style="font-family: &quot;Helvetica Neue&quot;; font-size: 11pt;">http://gitlab.example.com</a><span style="font-family: &quot;Helvetica Neue&quot;; font-size: 11pt;">'  并将</span><a href="http://gitlab.example.com/" style="font-family: &quot;Helvetica Neue&quot;; font-size: 11pt;">http://gitlab.example.com</a> <span style="font-family: &quot;Helvetica Neue&quot;; font-size: 11pt;">改成</span><a href="https://gitlab.example.com/" style="font-family: &quot;Helvetica Neue&quot;; font-size: 11pt;">https://gitlab.example.com</a></div><div>         找到 nginx相关的地方 修改证书地址  </div><div>            nginx['ssl_certificate']=&quot;/etc/gitlab/ssl/xxxxx.crt&quot;</div><div>            nginx['ssl_certificate_key']=&quot;/etc/gitlab/ssl/xxxxx.key&quot;</div><div>            nginx['ssl_dhparam']=&quot;/etc/gitlab/ssl/xxxxx.pem&quot;</div><div>        并去掉前面的#号 开启本行配置</div><div><br/></div><div>ssl代理配置  <span style="font-size: 14px; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: pre; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(40, 44, 52); color: rgb(171, 178, 191); font-family: &quot;Source Code Pro&quot;, &quot;DejaVu Sans Mono&quot;, &quot;Ubuntu Mono&quot;, &quot;Anonymous Pro&quot;, &quot;Droid Sans Mono&quot;, Menlo, Monaco, Consolas, Inconsolata, Courier, monospace, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, sans-serif; font-variant-caps: normal; font-variant-ligatures: common-ligatures;">vim /var/opt/gitlab/nginx/conf/gitlab-http.conf</span></div><div><span style="font-size: 14px; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: pre; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(40, 44, 52); color: rgb(171, 178, 191); font-family: &quot;Source Code Pro&quot;, &quot;DejaVu Sans Mono&quot;, &quot;Ubuntu Mono&quot;, &quot;Anonymous Pro&quot;, &quot;Droid Sans Mono&quot;, Menlo, Monaco, Consolas, Inconsolata, Courier, monospace, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, sans-serif; font-variant-caps: normal; font-variant-ligatures: common-ligatures;">在</span> <span style="font-size: 11pt; color: rgb(171, 178, 191); font-family: &quot;Source Code Pro&quot;;">server_name 10.0.0.42; 节点下配置</span></div><div><span style="font-size: 11pt; color: rgb(171, 178, 191); font-family: &quot;Source Code Pro&quot;;">   rewrite ^(.*)$ https://$host$1 permanent;</span></div><div><br/></div><div><br/></div><div><br/></div><div><span style="background-color: rgb(255, 250, 165); font-family: &quot;Helvetica Neue&quot;; font-size: 11pt;-evernote-highlight:true;">出错：unable to access '</span><a href="https://192.168.3.101/root/nodejs-test.git/" style="background-color: rgb(255, 250, 165); font-family: &quot;Helvetica Neue&quot;; font-size: 11pt;-evernote-highlight:true;">https://192.168.3.101/root/nodejs-test.git/</a><span style="background-color: rgb(255, 250, 165); font-family: &quot;Helvetica Neue&quot;; font-size: 11pt;-evernote-highlight:true;">'   应为会git会校验证书，本地的证书无效，所以无法访问</span></div><div><span style="font-size: 16px; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 250, 165); color: rgb(79, 79, 79); font-family: &quot;Microsoft YaHei&quot;, &quot;SF Pro Display&quot;, Roboto, Noto, Arial, &quot;PingFang SC&quot;, sans-serif; font-variant-caps: normal; font-variant-ligatures: normal;-evernote-highlight:true;">git config --global http.sslVerify false   取消ssl校验 成功下载项目</span></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><font style="font-size: 14pt;"><span style="font-size: 14pt; font-weight: bold;">gitlab-runner    （runner 是运行在测试机器上的，所以最好不和gitlab 安装在同一台机器）</span></font></div><ol><li><div>设置runner 安装源 curl -l <a href="https://packages.gitlab.com/install/repositories/runner/gitlab-runner/script.rpm.sh">https://packages.gitlab.com/install/repositories/runner/gitlab-runner/script.rpm.sh</a> | sudo bash</div></li><li><div>开始安装 yum install gitlab-runner</div></li><li><div>配置runner 到项目 gitlab-runner register   一步一步完成</div></li><li><div>注册时的key 在gitlab网站中 “[项目名称]/setting/cicd”</div></li></ol><div><br/></div><div><span style="font-size: 16px; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; color: rgb(79, 79, 79); font-family: &quot;Microsoft YaHei&quot;, &quot;SF Pro Display&quot;, Roboto, Noto, Arial, &quot;PingFang SC&quot;, sans-serif; font-variant-caps: normal; font-variant-ligatures: normal;">查看runner 的状态 ：gitlab-ci-multi-runner verify  </span></div><div><span style="font-size: 16px; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; color: rgb(79, 79, 79); font-family: &quot;Microsoft YaHei&quot;, &quot;SF Pro Display&quot;, Roboto, Noto, Arial, &quot;PingFang SC&quot;, sans-serif; font-variant-caps: normal; font-variant-ligatures: normal;">查看所有runner : </span> <span style="font-size: 16px; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; color: rgb(79, 79, 79); font-family: &quot;Microsoft YaHei&quot;, &quot;SF Pro Display&quot;, Roboto, Noto, Arial, &quot;PingFang SC&quot;, sans-serif; font-variant-caps: normal; font-variant-ligatures: normal;">gitlab-ci-multi-runner list</span></div><div><span style="font-size: 16px; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><br/></span></div><div><span style="font-size: 16px; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px;">注册runner时 如果是虚机 </span></div><div><span style="font-size: 16px; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><br/></span></div><div><span style="box-sizing: border-box; font-size: 13px; background-color: rgb(246, 246, 246); border-radius: 4px; border: none; white-space: pre-wrap; vertical-align: middle; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; color: rgb(199, 37, 78); font-family: Menlo, Monaco, Consolas, &quot;Courier New&quot;, monospace; font-variant-caps: normal; font-variant-ligatures: normal;">配置</span> <span style="background-color: rgb(246, 246, 246); font-size: 13px; white-space: pre-wrap; color: rgb(199, 37, 78); font-family: Menlo, Monaco, Consolas, &quot;Courier New&quot;, monospace; font-weight: bold;">.gitlab-ci.yml</span></div><div>before_script: # 定义在job执行之前的执行脚本(就一次)</div><div>  - sudo pkill -f node #每次启动job时停止所有node进程 <span style="background-color: rgb(255, 250, 165);-evernote-highlight:true;"><span style="background-color: rgb(255, 250, 165); color: rgb(227, 0, 0);-evernote-highlight:true;">（nodejs应用启动后会监听端口，再次跑job时会报错 所以杀掉node进程</span>）</span></div><div>stages: # 定义Pipeline的阶段，可以多个</div><div>  - deploy</div><div>##缓存 node_modules/目录 下次构建不会删除</div><div>cache:</div><div>  paths:</div><div>  - node_modules</div><div><br/></div><div>deploy_job:</div><div>  stage: deploy</div><div><span style="background-color: rgb(255, 250, 165);-evernote-highlight:true;"> <span style="background-color: rgb(255, 250, 165); color: rgb(255, 0, 0);-evernote-highlight:true;"> tags:</span></span></div><div><span style="background-color: rgb(255, 250, 165); color: rgb(255, 0, 0);-evernote-highlight:true;">      - firstrunner # 未配置会一直pending 导致job 无法启动</span></div><div>  script:</div><div>    - npm install</div><div>    - npm start</div><div><br/></div><div><span style="box-sizing: border-box; font-size: 13px; background-color: rgb(246, 246, 246); border-radius: 4px; border: none; white-space: pre-wrap; vertical-align: middle; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; color: rgb(199, 37, 78); font-family: Menlo, Monaco, Consolas, &quot;Courier New&quot;, monospace; font-variant-caps: normal; font-variant-ligatures: normal;">注意：.gitignore</span><span style="font-size: 16px; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(247, 247, 247); color: rgb(47, 47, 47); font-family: -apple-system, &quot;SF UI Text&quot;, Arial, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;WenQuanYi Micro Hei&quot;, sans-serif; font-variant-caps: normal; font-variant-ligatures: normal;">中的文件在每个job启动时都会被删除，可以使用cache或artifacts来实现文件重用</span></div><div><span style="font-size: 16px; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(247, 247, 247); color: rgb(47, 47, 47); font-family: -apple-system, &quot;SF UI Text&quot;, Arial, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;WenQuanYi Micro Hei&quot;, sans-serif; font-variant-caps: normal; font-variant-ligatures: normal;">    如果job一直处于pending 需要在runner机器上执行 gitlab-runner run 命令启动runner</span></div><div><br/></div><div><span style="font-size: 12pt; color: rgb(47, 47, 47);">问题1：</span> <span style="background-color: rgb(255, 250, 165);-evernote-highlight:true;"><span style="font-size: 12pt; background-color: rgb(255, 250, 165); color: rgb(47, 47, 47);-evernote-highlight:true;">unable to access '</span><a href="http://gitlab-ci-token:xxxxxx@myhost/user/test.git/" style="font-size: 12pt;background-color: rgb(255, 250, 165);-evernote-highlight:true;">http://gitlab-ci-token:xxxxxx@myhost/user/test.git/</a><span style="font-size: 12pt; background-color: rgb(255, 250, 165); color: rgb(47, 47, 47);-evernote-highlight:true;">': Couldn't resolve host 'myhost'</span></span></div><div><span style="font-size: 12pt; color: rgb(47, 47, 47);">解决方案： <span style="background-color: rgb(255, 250, 165); font-size: 12pt; color: rgb(47, 47, 47);-evernote-highlight:true;">在</span></span><span style="border: 0px; font-size: 13px; background-color: rgb(255, 250, 165); font-family: Consolas, Menlo, Monaco, &quot;Lucida Console&quot;, &quot;Liberation Mono&quot;, &quot;DejaVu Sans Mono&quot;, &quot;Bitstream Vera Sans Mono&quot;, &quot;Courier New&quot;, monospace, sans-serif;-evernote-highlight:true;">/etc/gitlab-runner/config.toml 文件中添加 红色的那一行</span></div><div style="background-color: rgb(239, 240, 241); font-size: 13px; letter-spacing: normal; orphans: 2; widows: 2; word-spacing: 0px;"><span style="border: 0px; font-size: 13px; background-color: rgb(239, 240, 241); color: rgb(36, 39, 41); font-family: Consolas, Menlo, Monaco, &quot;Lucida Console&quot;, &quot;Liberation Mono&quot;, &quot;DejaVu Sans Mono&quot;, &quot;Bitstream Vera Sans Mono&quot;, &quot;Courier New&quot;, monospace, sans-serif; font-variant-caps: normal; font-variant-ligatures: normal;">$ sudo cat /etc/gitlab-runner/config.toml</span></div><div style="background-color: rgb(239, 240, 241); font-size: 13px; letter-spacing: normal; orphans: 2; widows: 2; word-spacing: 0px;"><span style="border: 0px; font-size: 13px; background-color: rgb(239, 240, 241); color: rgb(36, 39, 41); font-family: Consolas, Menlo, Monaco, &quot;Lucida Console&quot;, &quot;Liberation Mono&quot;, &quot;DejaVu Sans Mono&quot;, &quot;Bitstream Vera Sans Mono&quot;, &quot;Courier New&quot;, monospace, sans-serif; font-variant-caps: normal; font-variant-ligatures: normal;">concurrent = 1</span></div><div style="background-color: rgb(239, 240, 241); font-size: 13px; letter-spacing: normal; orphans: 2; widows: 2; word-spacing: 0px;"><span style="border: 0px; font-size: 13px; background-color: rgb(239, 240, 241); color: rgb(36, 39, 41); font-family: Consolas, Menlo, Monaco, &quot;Lucida Console&quot;, &quot;Liberation Mono&quot;, &quot;DejaVu Sans Mono&quot;, &quot;Bitstream Vera Sans Mono&quot;, &quot;Courier New&quot;, monospace, sans-serif; font-variant-caps: normal; font-variant-ligatures: normal;">check_interval = 0</span></div><div style="background-color: rgb(239, 240, 241); font-size: 13px; letter-spacing: normal; orphans: 2; widows: 2; word-spacing: 0px;"><br/></div><div style="background-color: rgb(239, 240, 241); font-size: 13px; letter-spacing: normal; orphans: 2; widows: 2; word-spacing: 0px;"><span style="border: 0px; font-size: 13px; background-color: rgb(239, 240, 241); color: rgb(36, 39, 41); font-family: Consolas, Menlo, Monaco, &quot;Lucida Console&quot;, &quot;Liberation Mono&quot;, &quot;DejaVu Sans Mono&quot;, &quot;Bitstream Vera Sans Mono&quot;, &quot;Courier New&quot;, monospace, sans-serif; font-variant-caps: normal; font-variant-ligatures: normal;">[[runners]]</span></div><div style="background-color: rgb(239, 240, 241); font-size: 13px; letter-spacing: normal; orphans: 2; widows: 2; word-spacing: 0px;"><span style="border: 0px; font-size: 13px; background-color: rgb(239, 240, 241); color: rgb(36, 39, 41); font-family: Consolas, Menlo, Monaco, &quot;Lucida Console&quot;, &quot;Liberation Mono&quot;, &quot;DejaVu Sans Mono&quot;, &quot;Bitstream Vera Sans Mono&quot;, &quot;Courier New&quot;, monospace, sans-serif; font-variant-caps: normal; font-variant-ligatures: normal;">name = &quot;main&quot;</span></div><div style="background-color: rgb(239, 240, 241); font-size: 13px; letter-spacing: normal; orphans: 2; widows: 2; word-spacing: 0px;"><span style="font-size: 13px; background-color: rgb(239, 240, 241); border: 0px; color: rgb(36, 39, 41); font-family: Consolas, Menlo, Monaco, &quot;Lucida Console&quot;, &quot;Liberation Mono&quot;, &quot;DejaVu Sans Mono&quot;, &quot;Bitstream Vera Sans Mono&quot;, &quot;Courier New&quot;, monospace, sans-serif; font-variant-caps: normal; font-variant-ligatures: normal;">url = &quot;</span><a href="http://127.0.0.1:1337/" style="font-size: 13px; background-color: rgb(239, 240, 241); font-family: Consolas, Menlo, Monaco, &quot;Lucida Console&quot;, &quot;Liberation Mono&quot;, &quot;DejaVu Sans Mono&quot;, &quot;Bitstream Vera Sans Mono&quot;, &quot;Courier New&quot;, monospace, sans-serif; font-variant-caps: normal; font-variant-ligatures: normal;">http://127.0.0.1:1337/</a><span style="font-size: 13px; background-color: rgb(239, 240, 241); border: 0px; color: rgb(36, 39, 41); font-family: Consolas, Menlo, Monaco, &quot;Lucida Console&quot;, &quot;Liberation Mono&quot;, &quot;DejaVu Sans Mono&quot;, &quot;Bitstream Vera Sans Mono&quot;, &quot;Courier New&quot;, monospace, sans-serif; font-variant-caps: normal; font-variant-ligatures: normal;">&quot;</span></div><div style="background-color: rgb(239, 240, 241); font-size: 13px; letter-spacing: normal; orphans: 2; widows: 2; word-spacing: 0px;"><span style="border: 0px; font-size: 13px; background-color: rgb(239, 240, 241); color: rgb(36, 39, 41); font-family: Consolas, Menlo, Monaco, &quot;Lucida Console&quot;, &quot;Liberation Mono&quot;, &quot;DejaVu Sans Mono&quot;, &quot;Bitstream Vera Sans Mono&quot;, &quot;Courier New&quot;, monospace, sans-serif; font-variant-caps: normal; font-variant-ligatures: normal;">token = &quot;80500676b5518df3f3f3b1f772e20b&quot;</span></div><div style="background-color: rgb(239, 240, 241); font-size: 13px; letter-spacing: normal; orphans: 2; widows: 2; word-spacing: 0px;"><span style="border: 0px; font-size: 13px; background-color: rgb(239, 240, 241); color: rgb(36, 39, 41); font-family: Consolas, Menlo, Monaco, &quot;Lucida Console&quot;, &quot;Liberation Mono&quot;, &quot;DejaVu Sans Mono&quot;, &quot;Bitstream Vera Sans Mono&quot;, &quot;Courier New&quot;, monospace, sans-serif; font-variant-caps: normal; font-variant-ligatures: normal;">executor = &quot;docker&quot;</span></div><div style="background-color: rgb(239, 240, 241); font-size: 13px; letter-spacing: normal; orphans: 2; widows: 2; word-spacing: 0px;"><span style="border: 0px; font-size: 13px; background-color: rgb(239, 240, 241); color: rgb(36, 39, 41); font-family: Consolas, Menlo, Monaco, &quot;Lucida Console&quot;, &quot;Liberation Mono&quot;, &quot;DejaVu Sans Mono&quot;, &quot;Bitstream Vera Sans Mono&quot;, &quot;Courier New&quot;, monospace, sans-serif; font-variant-caps: normal; font-variant-ligatures: normal;">[runners.docker]</span></div><div style="background-color: rgb(239, 240, 241); font-size: 13px; letter-spacing: normal; orphans: 2; widows: 2; word-spacing: 0px;"><span style="border: 0px; font-size: 13px; background-color: rgb(239, 240, 241); color: rgb(36, 39, 41); font-family: Consolas, Menlo, Monaco, &quot;Lucida Console&quot;, &quot;Liberation Mono&quot;, &quot;DejaVu Sans Mono&quot;, &quot;Bitstream Vera Sans Mono&quot;, &quot;Courier New&quot;, monospace, sans-serif; font-variant-caps: normal; font-variant-ligatures: normal;">tls_verify = false</span></div><div style="background-color: rgb(239, 240, 241); font-size: 13px; letter-spacing: normal; orphans: 2; widows: 2; word-spacing: 0px;"><span style="border: 0px; font-size: 13px; background-color: rgb(239, 240, 241); color: rgb(36, 39, 41); font-family: Consolas, Menlo, Monaco, &quot;Lucida Console&quot;, &quot;Liberation Mono&quot;, &quot;DejaVu Sans Mono&quot;, &quot;Bitstream Vera Sans Mono&quot;, &quot;Courier New&quot;, monospace, sans-serif; font-variant-caps: normal; font-variant-ligatures: normal;">image = &quot;ubuntu:latest&quot;</span></div><div style="background-color: rgb(239, 240, 241); font-size: 13px; letter-spacing: normal; orphans: 2; widows: 2; word-spacing: 0px;"><span style="border: 0px; font-size: 13px; background-color: rgb(239, 240, 241); color: rgb(36, 39, 41); font-family: Consolas, Menlo, Monaco, &quot;Lucida Console&quot;, &quot;Liberation Mono&quot;, &quot;DejaVu Sans Mono&quot;, &quot;Bitstream Vera Sans Mono&quot;, &quot;Courier New&quot;, monospace, sans-serif; font-variant-caps: normal; font-variant-ligatures: normal;">privileged = false</span></div><div style="background-color: rgb(239, 240, 241); font-size: 13px; letter-spacing: normal; orphans: 2; widows: 2; word-spacing: 0px;"><span style="border: 0px; font-size: 13px; background-color: rgb(239, 240, 241); color: rgb(36, 39, 41); font-family: Consolas, Menlo, Monaco, &quot;Lucida Console&quot;, &quot;Liberation Mono&quot;, &quot;DejaVu Sans Mono&quot;, &quot;Bitstream Vera Sans Mono&quot;, &quot;Courier New&quot;, monospace, sans-serif; font-variant-caps: normal; font-variant-ligatures: normal;">disable_cache = false</span></div><div style="background-color: rgb(239, 240, 241); font-size: 13px; letter-spacing: normal; orphans: 2; widows: 2; word-spacing: 0px;"><span style="border: 0px; font-size: 13px; background-color: rgb(239, 240, 241); color: rgb(36, 39, 41); font-family: Consolas, Menlo, Monaco, &quot;Lucida Console&quot;, &quot;Liberation Mono&quot;, &quot;DejaVu Sans Mono&quot;, &quot;Bitstream Vera Sans Mono&quot;, &quot;Courier New&quot;, monospace, sans-serif; font-variant-caps: normal; font-variant-ligatures: normal;">volumes = [&quot;/cache&quot;]</span></div><div style="background-color: rgb(239, 240, 241); font-size: 13px; letter-spacing: normal; orphans: 2; widows: 2; word-spacing: 0px;"><span style="border: 0px; font-size: 13px; background-color: rgb(239, 240, 241); color: rgb(36, 39, 41); font-family: Consolas, Menlo, Monaco, &quot;Lucida Console&quot;, &quot;Liberation Mono&quot;, &quot;DejaVu Sans Mono&quot;, &quot;Bitstream Vera Sans Mono&quot;, &quot;Courier New&quot;, monospace, sans-serif; font-variant-caps: normal; font-variant-ligatures: normal;">shm_size = 0</span></div><div style="background-color: rgb(239, 240, 241); font-size: 13px; letter-spacing: normal; orphans: 2; widows: 2; word-spacing: 0px;"><span style="border: 0px; font-size: 13px; background-color: rgb(239, 240, 241);"><span style="font-size: 13px; background-color: rgb(239, 240, 241); color: rgb(255, 0, 0); font-family: Consolas, Menlo, Monaco, &quot;Lucida Console&quot;, &quot;Liberation Mono&quot;, &quot;DejaVu Sans Mono&quot;, &quot;Bitstream Vera Sans Mono&quot;, &quot;Courier New&quot;, monospace, sans-serif; font-variant-caps: normal; font-variant-ligatures: normal;">#extra_hosts = [&quot;</span></span><a href="http://gitlab.example.com/" style="font-size: 13px; color: rgb(255, 0, 0); font-family: Consolas; font-variant-caps: normal; font-variant-ligatures: normal;">gitlab.example.com</a><span style="border: 0px; font-size: 13px; background-color: rgb(239, 240, 241);"><span style="font-size: 13px; background-color: rgb(239, 240, 241); color: rgb(255, 0, 0); font-family: Consolas, Menlo, Monaco, &quot;Lucida Console&quot;, &quot;Liberation Mono&quot;, &quot;DejaVu Sans Mono&quot;, &quot;Bitstream Vera Sans Mono&quot;, &quot;Courier New&quot;, monospace, sans-serif; font-variant-caps: normal; font-variant-ligatures: normal;">:192.168.3.101&quot;]</span></span></div><div style="background-color: rgb(239, 240, 241); font-size: 13px; letter-spacing: normal; orphans: 2; widows: 2; word-spacing: 0px;"><span style="border: 0px; font-size: 13px; background-color: rgb(239, 240, 241); color: rgb(36, 39, 41); font-family: Consolas, Menlo, Monaco, &quot;Lucida Console&quot;, &quot;Liberation Mono&quot;, &quot;DejaVu Sans Mono&quot;, &quot;Bitstream Vera Sans Mono&quot;, &quot;Courier New&quot;, monospace, sans-serif; font-variant-caps: normal; font-variant-ligatures: normal;">[runners.cache]</span></div><div style="background-color: rgb(239, 240, 241); font-size: 13px; letter-spacing: normal; orphans: 2; widows: 2; word-spacing: 0px;"><span style="border: 0px; font-size: 13px; background-color: rgb(239, 240, 241);"><br/></span></div><div style="font-size: 13px; letter-spacing: normal; orphans: 2; widows: 2; word-spacing: 0px;"><span style="background-color: rgb(239, 240, 241); border: 0px; font-size: 13px; color: rgb(36, 39, 41); font-family: Consolas, Menlo, Monaco, &quot;Lucida Console&quot;, &quot;Liberation Mono&quot;, &quot;DejaVu Sans Mono&quot;, &quot;Bitstream Vera Sans Mono&quot;, &quot;Courier New&quot;, monospace, sans-serif; font-variant-caps: normal; font-variant-ligatures: normal;">问题2： </span><span style="background-color: rgb(255, 250, 165); font-size: 13px; color: rgb(36, 39, 41); font-family: Consolas;-evernote-highlight:true;">gitlab-runner中报 fatal: remote origin already exists</span></div><div style="font-size: 13px; letter-spacing: normal; orphans: 2; widows: 2; word-spacing: 0px;"><span style="background-color: rgb(239, 240, 241); font-size: 13px; color: rgb(36, 39, 41); font-family: Consolas;">解决方法：</span><span style="background-color: rgb(255, 250, 165); font-size: 13px; color: rgb(36, 39, 41); font-family: Consolas;-evernote-highlight:true;">docker system prune</span></div><div style="font-size: 13px; letter-spacing: normal; orphans: 2; widows: 2; word-spacing: 0px;"><span style="font-size: 13px; background-color: rgb(255, 250, 165); color: rgb(36, 39, 41); font-family: Consolas;-evernote-highlight:true;"> 或者执行 </span><span style="font-size: 13px; background-color: rgb(255, 250, 165); color: rgb(36, 39, 41); font-family: Consolas;-evernote-highlight:true;">docker container prune </span><span style="font-size: 13px; background-color: rgb(255, 250, 165); color: rgb(36, 39, 41); font-family: Consolas;-evernote-highlight:true;">&amp;</span> <span style="font-size: 13px; background-color: rgb(255, 250, 165); color: rgb(36, 39, 41); font-family: Consolas;-evernote-highlight:true;">docker volume prune </span><span style="font-size: 13px; background-color: rgb(255, 250, 165); color: rgb(36, 39, 41); font-family: Consolas;-evernote-highlight:true;">&amp;</span> <span style="font-size: 13px; background-color: rgb(255, 250, 165); color: rgb(36, 39, 41); font-family: Consolas;-evernote-highlight:true;">docker image prune </span></div><div style="background-color: rgb(239, 240, 241); font-size: 13px; letter-spacing: normal; orphans: 2; widows: 2; word-spacing: 0px;"></div><div style="background-color: rgb(239, 240, 241); font-size: 13px; letter-spacing: normal; orphans: 2; widows: 2; word-spacing: 0px;"></div><div><br/></div><div>问题3： <span style="background-color: rgb(255, 250, 165);-evernote-highlight:true;">有时候会出现runner 无法获取仓库文件, 是由于docker 无法访问仓库地址</span></div><div>解决方法：<span style="background-color: rgb(255, 250, 165);-evernote-highlight:true;">重启docker 服务， systemctl restart docker</span></div><div><span style="font-size: 16px; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><br/></span></div><div><span style="font-size: 16px; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><br/></span></div><div><span style="font-size: 16px; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px;">出现以下错误：</span></div><div><span style="font-size: 12pt;background-color: rgb(255, 250, 165);-evernote-highlight:true;"><span style="background-color: rgb(255, 250, 165); font-size: 12pt; color: rgb(50, 135, 18);-evernote-highlight:true;">There was an error running gitlab-ctl reconfigure:</span></span></div><div><span style="font-size: 12pt;background-color: rgb(255, 250, 165);-evernote-highlight:true;"><br/></span></div><div><span style="font-size: 12pt;background-color: rgb(255, 250, 165);-evernote-highlight:true;"><span style="background-color: rgb(255, 250, 165); font-size: 12pt; color: rgb(50, 135, 18);-evernote-highlight:true;">account[GitLab user and group] (gitlab::users line 28) had an error: Mixlib::ShellOut::ShellCommandFailed: linux_user[GitLab user and group] (/opt/gitlab/embedded/cookbooks/cache/cookbooks/package/resources/account.rb line 51) had an error: Mixlib::ShellOut::ShellCommandFailed: Expected process to exit with [0], but received '8'</span></span></div><div><span style="font-size: 12pt;background-color: rgb(255, 250, 165);-evernote-highlight:true;"><span style="background-color: rgb(255, 250, 165); font-size: 12pt; color: rgb(50, 135, 18);-evernote-highlight:true;">---- Begin output of [&quot;usermod&quot;, &quot;-s&quot;, &quot;/bin/sh&quot;, &quot;-d&quot;, &quot;/var/opt/gitlab&quot;, &quot;git&quot;] ----</span></span></div><div><span style="font-size: 12pt;background-color: rgb(255, 250, 165);-evernote-highlight:true;"><span style="background-color: rgb(255, 250, 165); font-size: 12pt; color: rgb(50, 135, 18);-evernote-highlight:true;">STDOUT:</span></span></div><div><span style="font-size: 12pt;background-color: rgb(255, 250, 165);-evernote-highlight:true;"><span style="background-color: rgb(255, 250, 165); font-size: 12pt; color: rgb(50, 135, 18);-evernote-highlight:true;">STDERR: usermod: user git is currently used by process 1528</span></span></div><div><span style="font-size: 12pt;background-color: rgb(255, 250, 165);-evernote-highlight:true;"><span style="background-color: rgb(255, 250, 165); font-size: 12pt; color: rgb(50, 135, 18);-evernote-highlight:true;">---- End output of [&quot;usermod&quot;, &quot;-s&quot;, &quot;/bin/sh&quot;, &quot;-d&quot;, &quot;/var/opt/gitlab&quot;, &quot;git&quot;] ----</span></span></div><div><span style="font-size: 12pt;background-color: rgb(255, 250, 165);-evernote-highlight:true;"><span style="background-color: rgb(255, 250, 165); font-size: 12pt; color: rgb(50, 135, 18);-evernote-highlight:true;">Ran [&quot;usermod&quot;, &quot;-s&quot;, &quot;/bin/sh&quot;, &quot;-d&quot;, &quot;/var/opt/gitlab&quot;, &quot;git&quot;] returned 8</span></span></div><div><span style="font-size: 12pt;background-color: rgb(255, 250, 165);-evernote-highlight:true;"><br/></span></div><div><span style="font-size: 12pt;background-color: rgb(255, 250, 165);-evernote-highlight:true;"><span style="background-color: rgb(255, 250, 165); font-size: 12pt; color: rgb(50, 135, 18);-evernote-highlight:true;">解决方法：在</span></span><span style="font-size: 11pt; font-family: &quot;Helvetica Neue&quot;;">/etc/gitlab/gitlab.rb 文件 配置一下两个节点  搜索到他们进行修改</span></div><div><span style="font-size: 12pt; color: rgb(50, 135, 18);">user['username'] = &quot;gitlab&quot;</span></div><div><span style="font-size: 12pt; color: rgb(50, 135, 18);">user['group'] = &quot;gitlab&quot;</span></div><div><span style="font-size: 12pt;"><br/></span></div><div><span style="font-size: 12pt;"><br/></span></div><div><span style="font-size: 12pt;"><br/></span></div><div><span style="color: rgb(0, 0, 0); font-family: Verdana, Arial, helvetica, sans-seriff; font-size: 12px; font-variant-ligatures: normal; font-variant-caps: normal; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px;">gerrit 主要用做CodeReview</span></div><div><span style="font-size: 12pt;"><br/></span></div><div><br/></div><div><br/></div></div><div><br/></div></span>
</div></body></html> 