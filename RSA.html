<html>
<head>
  <title>RSA</title>
  <basefont face="微软雅黑" size="2" />
  <meta http-equiv="Content-Type" content="text/html;charset=utf-8" />
  <meta name="exporter-version" content="YXBJ Windows/600667 (zh-CN, DDL); Windows/10.0.0 (Win64);"/>
  <style>
    body, td {
      font-family: 微软雅黑;
      font-size: 10pt;
    }
  </style>
</head>
<body>
<a name="556"/>
<h1>RSA</h1>

<div>
<span><div style="min-height: 11pt; text-align: left;">RSA 验签 代码</div><div style="min-height: 11pt; text-align: left;"><span style="min-height: 11pt; background-color: rgb(255, 250, 165); font-size: 9.5pt; color: rgb(0, 0, 255); font-family: Consolas;-evernote-highlight:true;"><br/></span></div><div style="min-height: 11pt; text-align: left;"><span style="min-height: 11pt; background-color: rgb(255, 250, 165); font-size: 9.5pt; color: rgb(0, 0, 255); font-family: Consolas;-evernote-highlight:true;">string</span> <span style="min-height: 11pt; background-color: rgb(255, 250, 165); font-size: 9.5pt; font-family: Consolas;-evernote-highlight:true;">token = HttpUtility.UrlDecode(</span><span style="min-height: 11pt; background-color: rgb(255, 250, 165); font-size: 9.5pt; color: rgb(163, 21, 21); font-family: Consolas;-evernote-highlight:true;">&quot;V7OMYsjQD8IxOayzupRxkcY8N%2fbynrp5H2WAPefzeX5vXI73%2bdcPupAKiA6podL52uIbuQ8VZw4pDduS7buTRyBTFbhZ9T%2bSJaLOszjBnvyzNzrd1L2WqnWoBiL%2bo6JDo3y371zUAKZ7D%2fhIpdGLilEhHEbJCw0HEyJgHWw%2bE1Y%3d&quot;</span><span style="min-height: 11pt; background-color: rgb(255, 250, 165); font-size: 9.5pt; font-family: Consolas;-evernote-highlight:true;">);</span><span style="min-height: 11pt; background-color: rgb(255, 250, 165); font-size: 9.5pt; color: rgb(0, 128, 0); font-family: Consolas;-evernote-highlight:true;">//是否需要UrlDecode视情况而定，可能取值后就已经UrlDecode，此时无需再UrlDecode</span><br/></div><div style="min-height: 11pt; text-align: left;"><span style="min-height: 11pt; background-color: rgb(255, 250, 165); font-size: 9.5pt; font-family: Consolas;-evernote-highlight:true;">           </span> <span style="min-height: 11pt; background-color: rgb(255, 250, 165); font-size: 9.5pt; color: rgb(0, 0, 255); font-family: Consolas;-evernote-highlight:true;">string</span> <span style="min-height: 11pt; background-color: rgb(255, 250, 165); font-size: 9.5pt; font-family: Consolas;-evernote-highlight:true;">exText = HttpUtility.UrlDecode(</span><span style="min-height: 11pt; background-color: rgb(255, 250, 165); font-size: 9.5pt; color: rgb(163, 21, 21); font-family: Consolas;-evernote-highlight:true;">&quot;VVNJRD0xNzQ1NDF8T1JHSUQ9MTE2ODg5fFRJTUU9MjAxOS0wNC0yOVQxNDo1MjowNnxJUD05OS4xMi4zOS4yMjB8U0FQSUQ9ODAxNzQ1NDF8RU1BSUw9aGV5YW5namlhbkBjbWJjaGluYS5jb218TkFNRT262NH0vaN8QlIxPTEwMDAwM3xQQVRIPdfc0NAv0MXPory8yvWyvy%2fV0NL4zfjC57%2fGvLwv0dC3otbQ0MQvyv2%2b3bLWv%2bK%2fqreizcW20y%2b8qNCnudzA7dOm08O%2fqreiytKjqMnu29qjqXxHUElEPTAxMDAwNDU4VEc%3d&quot;</span><span style="min-height: 11pt; background-color: rgb(255, 250, 165); font-size: 9.5pt; font-family: Consolas;-evernote-highlight:true;">);</span><span style="min-height: 11pt; background-color: rgb(255, 250, 165); font-size: 9.5pt; color: rgb(0, 128, 0); font-family: Consolas;-evernote-highlight:true;">//是否需要UrlDecode视情况而定，可能取值后就已经UrlDecode，此时无需再UrlDecode</span></div><div style="min-height: 11pt; text-align: left;"><span style="min-height: 11pt; background-color: rgb(255, 250, 165); font-size: 9.5pt; font-family: Consolas;-evernote-highlight:true;">           </span> <span style="min-height: 11pt; background-color: rgb(255, 250, 165); font-size: 9.5pt; color: rgb(0, 0, 255); font-family: Consolas;-evernote-highlight:true;">byte</span><span style="min-height: 11pt; background-color: rgb(255, 250, 165); font-size: 9.5pt; font-family: Consolas;-evernote-highlight:true;">[] newBytes = Convert.FromBase64String(exText);</span> <span style="min-height: 11pt; background-color: rgb(255, 250, 165); font-size: 9.5pt; color: rgb(0, 128, 0); font-family: Consolas;-evernote-highlight:true;">//解析出相应的明文信息</span></div><div style="min-height: 11pt; text-align: left;"><span style="min-height: 11pt; background-color: rgb(255, 250, 165); font-size: 9.5pt; font-family: Consolas;-evernote-highlight:true;">           </span> <span style="min-height: 11pt; background-color: rgb(255, 250, 165); font-size: 9.5pt; color: rgb(0, 0, 255); font-family: Consolas;-evernote-highlight:true;">string</span> <span style="min-height: 11pt; background-color: rgb(255, 250, 165); font-size: 9.5pt; font-family: Consolas;-evernote-highlight:true;">strData = Encoding.GetEncoding(</span><span style="min-height: 11pt; background-color: rgb(255, 250, 165); font-size: 9.5pt; color: rgb(163, 21, 21); font-family: Consolas;-evernote-highlight:true;">&quot;gb2312&quot;</span><span style="min-height: 11pt; background-color: rgb(255, 250, 165); font-size: 9.5pt; font-family: Consolas;-evernote-highlight:true;">).GetString(newBytes);</span></div><div style="min-height: 11pt; text-align: left;"><span style="min-height: 11pt; background-color: rgb(255, 250, 165); font-size: 9.5pt; font-family: Consolas;-evernote-highlight:true;">           </span> <span style="min-height: 11pt; background-color: rgb(255, 250, 165); font-size: 9.5pt; color: rgb(0, 0, 255); font-family: Consolas;-evernote-highlight:true;">string</span><span style="min-height: 11pt; background-color: rgb(255, 250, 165); font-size: 9.5pt; font-family: Consolas;-evernote-highlight:true;">[] sArray = strData.Split(</span><span style="min-height: 11pt; background-color: rgb(255, 250, 165); font-size: 9.5pt; color: rgb(163, 21, 21); font-family: Consolas;-evernote-highlight:true;">'|'</span><span style="min-height: 11pt; background-color: rgb(255, 250, 165); font-size: 9.5pt; font-family: Consolas;-evernote-highlight:true;">);</span></div><div style="min-height: 11pt; text-align: left;"><span style="min-height: 11pt; background-color: rgb(255, 250, 165); font-size: 9.5pt; font-family: Consolas;-evernote-highlight:true;">           </span> <span style="min-height: 11pt; background-color: rgb(255, 250, 165); font-size: 9.5pt; color: rgb(0, 0, 255); font-family: Consolas;-evernote-highlight:true;">string</span> <span style="min-height: 11pt; background-color: rgb(255, 250, 165); font-size: 9.5pt; font-family: Consolas;-evernote-highlight:true;">timed =</span> <span style="min-height: 11pt; background-color: rgb(255, 250, 165); font-size: 9.5pt; color: rgb(0, 0, 255); font-family: Consolas;-evernote-highlight:true;">null</span><span style="min-height: 11pt; background-color: rgb(255, 250, 165); font-size: 9.5pt; font-family: Consolas;-evernote-highlight:true;">;</span></div><div style="min-height: 11pt; text-align: left;"><span style="min-height: 11pt; background-color: rgb(255, 250, 165); font-size: 9.5pt; font-family: Consolas;-evernote-highlight:true;">           </span> <span style="min-height: 11pt; background-color: rgb(255, 250, 165); font-size: 9.5pt; color: rgb(0, 0, 255); font-family: Consolas;-evernote-highlight:true;">foreach</span> <span style="min-height: 11pt; background-color: rgb(255, 250, 165); font-size: 9.5pt; font-family: Consolas;-evernote-highlight:true;">(</span><span style="min-height: 11pt; background-color: rgb(255, 250, 165); font-size: 9.5pt; color: rgb(0, 0, 255); font-family: Consolas;-evernote-highlight:true;">string</span> <span style="min-height: 11pt; background-color: rgb(255, 250, 165); font-size: 9.5pt; font-family: Consolas;-evernote-highlight:true;">i</span> <span style="min-height: 11pt; background-color: rgb(255, 250, 165); font-size: 9.5pt; color: rgb(0, 0, 255); font-family: Consolas;-evernote-highlight:true;">in</span> <span style="min-height: 11pt; background-color: rgb(255, 250, 165); font-size: 9.5pt; font-family: Consolas;-evernote-highlight:true;">sArray)</span></div><div style="min-height: 11pt; text-align: left;"><span style="min-height: 11pt; font-size: 9.5pt; font-family: Consolas; background-color: rgb(255, 250, 165);-evernote-highlight:true;">            {</span></div><div style="min-height: 11pt; text-align: left;"><span style="min-height: 11pt; background-color: rgb(255, 250, 165); font-size: 9.5pt; font-family: Consolas;-evernote-highlight:true;">               </span> <span style="min-height: 11pt; background-color: rgb(255, 250, 165); font-size: 9.5pt; color: rgb(0, 0, 255); font-family: Consolas;-evernote-highlight:true;">if</span> <span style="min-height: 11pt; background-color: rgb(255, 250, 165); font-size: 9.5pt; font-family: Consolas;-evernote-highlight:true;">(i.Contains(</span><span style="min-height: 11pt; background-color: rgb(255, 250, 165); font-size: 9.5pt; color: rgb(163, 21, 21); font-family: Consolas;-evernote-highlight:true;">&quot;TIME&quot;</span><span style="min-height: 11pt; background-color: rgb(255, 250, 165); font-size: 9.5pt; font-family: Consolas;-evernote-highlight:true;">))</span></div><div style="min-height: 11pt; text-align: left;"><span style="min-height: 11pt; font-size: 9.5pt; font-family: Consolas; background-color: rgb(255, 250, 165);-evernote-highlight:true;">                {</span></div><div style="min-height: 11pt; text-align: left;"><span style="min-height: 11pt; background-color: rgb(255, 250, 165); font-size: 9.5pt; font-family: Consolas;-evernote-highlight:true;">                    timed = i;</span> <span style="min-height: 11pt; background-color: rgb(255, 250, 165); font-size: 9.5pt; color: rgb(0, 0, 255); font-family: Consolas;-evernote-highlight:true;">break</span><span style="min-height: 11pt; background-color: rgb(255, 250, 165); font-size: 9.5pt; font-family: Consolas;-evernote-highlight:true;">;</span></div><div style="min-height: 11pt; text-align: left;"><span style="min-height: 11pt; font-size: 9.5pt; font-family: Consolas; background-color: rgb(255, 250, 165);-evernote-highlight:true;">                }</span></div><div style="min-height: 11pt; text-align: left;"><span style="min-height: 11pt; font-size: 9.5pt; font-family: Consolas; background-color: rgb(255, 250, 165);-evernote-highlight:true;">            }</span></div><div style="min-height: 11pt; text-align: left;"><span style="min-height: 11pt; background-color: rgb(255, 250, 165); font-size: 9.5pt; font-family: Consolas;-evernote-highlight:true;">           </span> <span style="min-height: 11pt; background-color: rgb(255, 250, 165); font-size: 9.5pt; color: rgb(0, 0, 255); font-family: Consolas;-evernote-highlight:true;">string</span> <span style="min-height: 11pt; background-color: rgb(255, 250, 165); font-size: 9.5pt; font-family: Consolas;-evernote-highlight:true;">cerateTime = timed.Remove(0, 5);</span><span style="min-height: 11pt; background-color: rgb(255, 250, 165); font-size: 9.5pt; color: rgb(0, 128, 0); font-family: Consolas;-evernote-highlight:true;">//获取的时间 //判断有效期</span></div><div style="min-height: 11pt; text-align: left;"><span style="min-height: 11pt; font-size: 9.5pt; font-family: Consolas; background-color: rgb(255, 250, 165);-evernote-highlight:true;">            DateTime dt1 = Convert.ToDateTime(cerateTime);</span></div><div style="min-height: 11pt; text-align: left;"><span style="min-height: 11pt; font-size: 9.5pt; font-family: Consolas; background-color: rgb(255, 250, 165);-evernote-highlight:true;">            DateTime dt2 = System.DateTime.Now;</span></div><div style="min-height: 11pt; text-align: left;"><span style="min-height: 11pt; font-size: 9.5pt; font-family: Consolas; background-color: rgb(255, 250, 165);-evernote-highlight:true;">            TimeSpan tsS = dt2 - dt1;    </span></div><div style="min-height: 11pt; text-align: left;"><span style="min-height: 11pt; background-color: rgb(255, 250, 165); font-size: 9.5pt; font-family: Consolas;-evernote-highlight:true;">           </span> <span style="min-height: 11pt; background-color: rgb(255, 250, 165); font-size: 9.5pt; color: rgb(0, 0, 255); font-family: Consolas;-evernote-highlight:true;">double</span> <span style="min-height: 11pt; background-color: rgb(255, 250, 165); font-size: 9.5pt; font-family: Consolas;-evernote-highlight:true;">mins = tsS.TotalMinutes;</span><span style="min-height: 11pt; background-color: rgb(255, 250, 165); font-size: 9.5pt; color: rgb(0, 128, 0); font-family: Consolas;-evernote-highlight:true;">//TotalMinutes TotalDays</span></div><div style="min-height: 11pt; text-align: left;"><span style="min-height: 11pt; background-color: rgb(255, 250, 165); font-size: 9.5pt; font-family: Consolas;-evernote-highlight:true;">            mins = System.Math.Abs(mins);</span><span style="min-height: 11pt; background-color: rgb(255, 250, 165); font-size: 9.5pt; color: rgb(0, 128, 0); font-family: Consolas;-evernote-highlight:true;">//求时间绝对值</span></div><div style="min-height: 11pt; text-align: left;"><span style="min-height: 11pt; background-color: rgb(255, 250, 165); font-size: 9.5pt; font-family: Consolas;-evernote-highlight:true;">           </span> <span style="min-height: 11pt; background-color: rgb(255, 250, 165); font-size: 9.5pt; color: rgb(0, 0, 255); font-family: Consolas;-evernote-highlight:true;">if</span> <span style="min-height: 11pt; background-color: rgb(255, 250, 165); font-size: 9.5pt; font-family: Consolas;-evernote-highlight:true;">(mins &gt; 10)</span><span style="min-height: 11pt; background-color: rgb(255, 250, 165); font-size: 9.5pt; color: rgb(0, 128, 0); font-family: Consolas;-evernote-highlight:true;">//10分钟以内，token有效</span></div><div style="min-height: 11pt; text-align: left;"><span style="min-height: 11pt; font-size: 9.5pt; font-family: Consolas; background-color: rgb(255, 250, 165);-evernote-highlight:true;">            {</span></div><div style="min-height: 11pt; text-align: left;"><span style="min-height: 11pt; background-color: rgb(255, 250, 165); font-size: 9.5pt; font-family: Consolas;-evernote-highlight:true;">               </span> <span style="min-height: 11pt; background-color: rgb(255, 250, 165); font-size: 9.5pt; color: rgb(0, 0, 255); font-family: Consolas;-evernote-highlight:true;">byte</span><span style="min-height: 11pt; background-color: rgb(255, 250, 165); font-size: 9.5pt; font-family: Consolas;-evernote-highlight:true;">[] signatureByte = Convert.FromBase64String(token);</span></div><div style="min-height: 11pt; text-align: left;"><span style="min-height: 11pt; background-color: rgb(255, 250, 165); font-size: 9.5pt; font-family: Consolas;-evernote-highlight:true;">                X509Certificate2 x509 =</span> <span style="min-height: 11pt; background-color: rgb(255, 250, 165); font-size: 9.5pt; color: rgb(0, 0, 255); font-family: Consolas;-evernote-highlight:true;">new</span> <span style="min-height: 11pt; background-color: rgb(255, 250, 165); font-size: 9.5pt; font-family: Consolas;-evernote-highlight:true;">X509Certificate2(</span><span style="min-height: 11pt; background-color: rgb(255, 250, 165); font-size: 9.5pt; color: rgb(163, 21, 21); font-family: Consolas;-evernote-highlight:true;">&quot;d:\\key.pfx&quot;</span><span style="min-height: 11pt; background-color: rgb(255, 250, 165); font-size: 9.5pt; font-family: Consolas;-evernote-highlight:true;">);</span><span style="min-height: 11pt; background-color: rgb(255, 250, 165); font-size: 9.5pt; color: rgb(0, 128, 0); font-family: Consolas;-evernote-highlight:true;">//证书下载见“文件下载”章节</span></div><div style="min-height: 11pt; text-align: left;"><span style="min-height: 11pt; font-size: 9.5pt; font-family: Consolas; background-color: rgb(255, 250, 165);-evernote-highlight:true;">                RSACryptoServiceProvider rsa = (RSACryptoServiceProvider)x509.PublicKey.Key;</span></div><div style="min-height: 11pt; text-align: left;"><span style="min-height: 11pt; background-color: rgb(255, 250, 165); font-size: 9.5pt; font-family: Consolas;-evernote-highlight:true;">               </span> <span style="min-height: 11pt; background-color: rgb(255, 250, 165); font-size: 9.5pt; color: rgb(0, 0, 255); font-family: Consolas;-evernote-highlight:true;">bool</span> <span style="min-height: 11pt; background-color: rgb(255, 250, 165); font-size: 9.5pt; font-family: Consolas;-evernote-highlight:true;">isCheck = rsa.VerifyData(newBytes,</span> <span style="min-height: 11pt; background-color: rgb(255, 250, 165); font-size: 9.5pt; color: rgb(0, 0, 255); font-family: Consolas;-evernote-highlight:true;">new</span> <span style="min-height: 11pt; background-color: rgb(255, 250, 165); font-size: 9.5pt; font-family: Consolas;-evernote-highlight:true;">SHA1CryptoServiceProvider(), signatureByte);</span></div><div style="min-height: 11pt; text-align: left;"><span style="min-height: 11pt; background-color: rgb(255, 250, 165); font-size: 9.5pt; font-family: Consolas;-evernote-highlight:true;">               </span> <span style="min-height: 11pt; background-color: rgb(255, 250, 165); font-size: 9.5pt; color: rgb(0, 0, 255); font-family: Consolas;-evernote-highlight:true;">if</span> <span style="min-height: 11pt; background-color: rgb(255, 250, 165); font-size: 9.5pt; font-family: Consolas;-evernote-highlight:true;">(isCheck)</span></div><div style="min-height: 11pt; text-align: left;"><span style="min-height: 11pt; font-size: 9.5pt; font-family: Consolas; background-color: rgb(255, 250, 165);-evernote-highlight:true;">                {</span></div><div style="min-height: 11pt; text-align: left;"><span style="min-height: 11pt; background-color: rgb(255, 250, 165); font-size: 9.5pt; font-family: Consolas;-evernote-highlight:true;">                    Console.WriteLine(</span><span style="min-height: 11pt; background-color: rgb(255, 250, 165); font-size: 9.5pt; color: rgb(163, 21, 21); font-family: Consolas;-evernote-highlight:true;">&quot;校验签名TRUE&quot;</span><span style="min-height: 11pt; background-color: rgb(255, 250, 165); font-size: 9.5pt; font-family: Consolas;-evernote-highlight:true;">);</span></div><div style="min-height: 11pt; text-align: left;"><span style="min-height: 11pt; font-size: 9.5pt; font-family: Consolas; background-color: rgb(255, 250, 165);-evernote-highlight:true;">                }</span></div><div style="min-height: 11pt; text-align: left;"><span style="min-height: 11pt; background-color: rgb(255, 250, 165); font-size: 9.5pt; font-family: Consolas;-evernote-highlight:true;">               </span> <span style="min-height: 11pt; background-color: rgb(255, 250, 165); font-size: 9.5pt; color: rgb(0, 0, 255); font-family: Consolas;-evernote-highlight:true;">else</span></div><div style="min-height: 11pt; text-align: left;"><span style="min-height: 11pt; font-size: 9.5pt; font-family: Consolas; background-color: rgb(255, 250, 165);-evernote-highlight:true;">                {</span></div><div style="min-height: 11pt; text-align: left;"><span style="min-height: 11pt; background-color: rgb(255, 250, 165); font-size: 9.5pt; font-family: Consolas;-evernote-highlight:true;">                    Console.WriteLine(</span><span style="min-height: 11pt; background-color: rgb(255, 250, 165); font-size: 9.5pt; color: rgb(163, 21, 21); font-family: Consolas;-evernote-highlight:true;">&quot;校验签名FALSER&quot;</span><span style="min-height: 11pt; background-color: rgb(255, 250, 165); font-size: 9.5pt; font-family: Consolas;-evernote-highlight:true;">);</span></div><div style="min-height: 11pt; text-align: left;"><span style="min-height: 11pt; font-size: 9.5pt; font-family: Consolas; background-color: rgb(255, 250, 165);-evernote-highlight:true;">                }</span></div><div style="min-height: 11pt; text-align: left;"><span style="min-height: 11pt; font-size: 9.5pt; font-family: Consolas; background-color: rgb(255, 250, 165);-evernote-highlight:true;">            }</span></div><div style="min-height: 11pt; text-align: left;"><span style="min-height: 11pt; background-color: rgb(255, 250, 165); font-size: 9.5pt; font-family: Consolas;-evernote-highlight:true;">           </span> <span style="min-height: 11pt; background-color: rgb(255, 250, 165); font-size: 9.5pt; color: rgb(0, 0, 255); font-family: Consolas;-evernote-highlight:true;">else</span></div><div style="min-height: 11pt; text-align: left;"><span style="min-height: 11pt; font-size: 9.5pt; font-family: Consolas; background-color: rgb(255, 250, 165);-evernote-highlight:true;">            {</span></div><div style="min-height: 11pt; text-align: left;"><span style="min-height: 11pt; background-color: rgb(255, 250, 165); font-size: 9.5pt; font-family: Consolas;-evernote-highlight:true;">                Console.WriteLine(</span><span style="min-height: 11pt; background-color: rgb(255, 250, 165); font-size: 9.5pt; color: rgb(163, 21, 21); font-family: Consolas;-evernote-highlight:true;">&quot;时间超过10分钟，token失效&quot;</span><span style="min-height: 11pt; background-color: rgb(255, 250, 165); font-size: 9.5pt; font-family: Consolas;-evernote-highlight:true;">);</span></div><div style="min-height: 11pt; text-align: left;"><span style="min-height: 11pt; font-size: 9.5pt; font-family: Consolas; background-color: rgb(255, 250, 165);-evernote-highlight:true;">            }</span><br/></div></span>
</div></body></html> 